<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
		<script src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdn.staticfile.org/popper.js/1.14.7/umd/popper.min.js"></script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
		<script src="https://cdn.staticfile.org/template_js/0.8.0/template.js"></script>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.eot"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.svg"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.ttf"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.woff"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/FontAwesome.otf"/>
		<link href="https://cdn.staticfile.org/twitter-bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet"/>
		<title>首页</title>
	</head>

	<style>
		.footer-icon, .footer-text {
			position: absolute;
		}

		.footer-text {
			bottom: -0.2em
		}

		a {
			text-decoration: none;
			color: inherit;
		}
	</style>

	<body>
		<div id="navbar"></div>
		<div id="post" style="width: 80%; margin-left: 10%; margin-top: 1.5em">
		</div>
		<div class="dropdown" style="position: fixed; right: 1em; top: 5em">
			<button id="changeSortTypeBtn" class="btn btn-outline-dark dropdown-toggle" style="width: 5em;"
					type="button" id="post_rank_drop" data-toggle="dropdown" aria-haspopup="true"
					aria-expanded="false">
				按热度
			</button>
			<div class="dropdown-menu" aria-labelledby="post_rank_drop">
				<a id="anotherSortType" class="dropdown-item">按时间</a>
			</div>
		</div>
		<button id="publishBtn" class="bg-primary text-white" onclick=""
				style="width: 5em; height: 5em; border-radius: 100%; position: fixed; bottom: 3em; right: 1em">
			<span style="font-size: 1.5em">发布</span>
			<script>
                $('#publishBtn').click(function () {
                    window.location.href = 'publish.html';
                });
			</script>
		</button>
	</body>

	<script id="postTp" type="text/html">
		<%for(let i = 0; i < list.length; i++) {%>
		<div id="post_<%:=list[i].id%>" class="card mt-4">
			<div class="card-header" style="position: relative">
				<img src="<%:=getUserAvatarUrl(list[i].creator)%>" style="border-radius: 100%; width: 50px;height: 50px"/>
				<a href="user_info.html?user_id=<%:=list[i].creator.id%>" class="text-dark"><%:=list[i].creator.nick_name%></a>
				<%if(list[i].is_topped){%><span class="badge badge-primary">置顶</span><%}%>
				<span style="position: absolute; right: 1em; bottom: 0.25em"><%:=contentDropTp({content: list[i]})%></span>
			</div>
			<div class="card-body">
				<%if(list[i].title){%>
				<h5 class="card-title"><%:=list[i].title%></h5>
				<%}%>
				<p id="post_content_<%:=list[i].id%>" style="text-indent: 2em" onclick="showFullText(this)"
				   class="card-text"><%:=list[i].content%></p>
				<%if(typeof list[i].full_text_id !== 'undefined'){%>
				<button data-id="<%:=list[i].id%>" data-full-text-id="<%:=list[i].full_text_id%>"
						onclick="showFullText(this)" class="btn btn-link card-link text-muted">查看全文
				</button>
				<%}%>
				<div id="post_img_<%:=list[i].id%>">
					<%if(typeof list[i].raw_img !== 'undefined'){%>
					<%const _img = list[i].raw_img.split('#');%>
					<%for(let j = 0; j < _img.length; ++j){%>
					<div style="display: inline;margin-left: 1em">
						<a onclick="showFullImg('<%:=_img[j]%>')" class="thumbnail"><img src="<%:=getPostThumbUrl(_img[j])%>"></a>
					</div>
					<%}%>
					<%}%>
				</div>
				<p class="card-link text-right text-muted">
					<%if(typeof list[i].category_path !== 'undefined'){%>
					<%:=getCategoryPathStr(list[i].category_path)%>
					<%}%>
				</p>
			</div>
			<div class="card-footer text-muted text-left" style="position:relative">
				<%:=getFormatDate(list[i].create_time, 'yyyy年MM月dd日 hh:mm')%>
				<div style="position: absolute; right: 12em; bottom: -0.1em">
					<%if(list[i].is_topped && list[i].rights && list[i].rights.be_topped){%>
					<button class="btn btn-link" style="margin-bottom: 0.2em;" data-id="<%:=list[i].id%>" onclick="setPostTop(this, true)">
						取消置顶
					</button>
					<%}else if(list[i].rights && list[i].rights.be_topped){%>
					<button class="btn btn-link" style="margin-bottom: 0.2em;" data-id="<%:=list[i].id%>" onclick="setPostTop(this, false)">
						置顶
					</button>
					<%}%>
					<button class="btn btn-link" onclick="showLikeList('<%:=list[i].id%>','post')" style="margin-bottom: 0.2em;">查看点赞列表</button>
				</div>
				<div style="position: absolute; right: 1em; font-size: 1.25em">
					<span data-id="<%:=list[i].id%>" class="footer-icon icon-external-link" data-shown="0" onclick="showPostForward(this)" style="right:7em; bottom: -0.14em"></span>
					<span id="forward_cnt_<%:=list[i].id%>" class="footer-text" style="right:6em"><%:=list[i].forward_cnt%></span>
					<span data-id="<%:=list[i].id%>" data-shown="0" onclick="showPostComment(this, 'l1', 'popular')"
						  class="footer-icon icon-comment-alt" style="right:4.5em; bottom: 0em"></span>
					<span id="comment_l1_cnt_<%:=list[i].id%>" class="footer-text" style="right:3.5em"><%:=list[i].comment_cnt%></span>
					<%if(list[i].liked_by_viewer){%>
					<span style="right:2em; bottom: -0.075em" data-liked="1" data-id="<%:=list[i].id%>"
						  onclick="createOrCancelLike(this, 'post')" class="footer-icon icon-heart">
					</span>
					<%}else{%>
					<span style="right:2em; bottom: -0.075em" data-liked="0" data-id="<%:=list[i].id%>"
						  onclick="createOrCancelLike(this, 'post')" class="footer-icon icon-heart-empty">
								</span>
					<%}%>
					<span id="like_cnt_post_<%:=list[i].id%>" class="footer-text"
						  style="right:1em"><%:=list[i].like_cnt%></span>
				</div>
			</div>
		</div>
		<%:=commentOfPostTp({post: list[i]})%>
		<%:=forwardOfPostTp({post: list[i]})%>
		<%}%>
	</script>

	<div class="modal fade" id="img-modal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content w-auto">
				<img id="modal-img"/>
			</div>
		</div>
	</div>

	<script src="/static/js/common.js"></script>
	<script src="/static/js/comp/navbar.js"></script>
	<script src="/static/js/comp/content.js"></script>
	<script src="/static/js/comp/comment.js"></script>
	<script src="/static/js/comp/forward.js"></script>
	<script src="/static/js/post_list.js"></script>
</html>