<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
		<script src="https://cdn.staticfile.org/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdn.staticfile.org/popper.js/1.14.7/umd/popper.min.js"></script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/4.2.1/js/bootstrap.min.js"></script>
		<script src="https://cdn.staticfile.org/template_js/0.8.0/template.js"></script>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.eot"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.svg"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.ttf"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/fontawesome-webfont.woff"/>
		<link href="https://cdn.staticfile.org/font-awesome/3.2.1/font/FontAwesome.otf"/>
		<link href="https://cdn.staticfile.org/twitter-bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet"/>
		<title>动态</title>
	</head>

	<style>
		.footer-icon, .footer-text {
			position: absolute;
		}

		.footer-text {
			bottom: -0.2em
		}

		a {
			text-decoration: none;
			color: inherit;
		}
	</style>

	<body>
		<div id="navbar"></div>
		<div id="post" style="width: 80%; margin-left: 10%; margin-top: 1.5em">
		</div>
	</body>

	<script id="postTp" type="text/html">
		<%for(let i = 0; i < list.length; i++) {%>
		<%if(typeof list[i].content === 'undefined'){%><%continue;}%>
		<div id="post_<%:=list[i].content.id%>" class="card mt-4">
			<div class="card-header" style="position: relative">
				<img src="<%:=getUserAvatarUrl(list[i].content.creator)%>" style="border-radius: 100%; width: 50px;height: 50px"/>
				<a href="user_info.html?user_id=<%:=list[i].content.creator.id%>" class="text-dark"><%:=list[i].content.creator.nick_name%></a>
				<span style="position: absolute; right: 1em; bottom: 0.25em"><%:=contentDropTp({content: list[i].content})%></span>
			</div>
			<div class="card-body">
				<%if(list[i].content.title){%>
				<h5 class="card-title"><%:=list[i].content.title%></h5>
				<%}%>
				<p id="post_content_<%:=list[i].content.id%>" style="text-indent: 2em" onclick="showFullText(this)"
				   class="card-text"><%:=list[i].content.content%></p>
				<%if(typeof list[i].content.full_text_id !== 'undefined'){%>
				<button data-id="<%:=list[i].content.id%>" data-full-text-id="<%:=list[i].content.full_text_id%>" onclick="showFullText(this)" class="btn btn-link card-link text-muted">查看全文</button>
				<%}%>
				<div id="post_img_<%:=list[i].content.id%>">
					<%if(typeof list[i].content.raw_img !== 'undefined'){%>
					<%const _img = list[i].content.raw_img.split('#');%>
					<%for(let j = 0; j < _img.length; ++j){%>
					<div style="display: inline;margin-left: 1em">
						<a onclick="showFullImg('<%:=_img[j]%>')" class="thumbnail"><img src="<%:=getPostThumbUrl(_img[j])%>"></a>
					</div>
					<%}%>
					<%}%>
				</div>
				<%if(list[i].content.type_str === 'forward'){%>
					<%const ori_post = list[i].content.ori_post;%>
					<div id="<%:=list[i].content.id%>_ori_post" data-id="<%:=ori_post.id%>" class="card bg-light">
						<div class="card-header" style="position: relative">
							<img src="<%:=getUserAvatarUrl(ori_post.creator)%>" style="border-radius: 100%; width: 50px;height: 50px"/>
							<a href="user_info.html?user_id=<%:=ori_post.creator.id%>" class="text-dark"><%:=ori_post.creator.nick_name%></a>
						</div>
						<div class="card-body">
							<%if(ori_post.title){%>
							<h5 class="card-title"><%:=ori_post.title%></h5>
							<%}%>
							<p id="<%:=list[i].content.id%>_ori_post_content_" data-id="<%:=ori_post.id%>" style="text-indent: 2em" class="card-text"><%:=ori_post.content%></p>
						</div>
						<div id="post_fw_<%:=ori_post.id%>_of_<%:=list[i].id%_img>">
							<%if(typeof ori_post.raw_img !== 'undefined'){%>
							<%const _img = ori_post.raw_img.split('#');%>
							<%for(let j = 0; j < _img.length; ++j){%>
							<div style="display: inline;margin-left: 1em">
								<a onclick="showFullImg('<%:=_img[j]%>')" class="thumbnail"><img src="<%:=getPostThumbUrl(_img[j])%>"></a>
							</div>
							<%}%>
							<%}%>
						</div>
						<p class="card-link text-right text-muted">
							<%if(typeof ori_post.category_path !== 'undefined' && ori_post.type_str === 'public'){%>
							<%:=getCategoryPathStr(ori_post.category_path)%>
							<%}%>
						</p>
					</div>
				<%}%>
				<p class="card-link text-right text-muted">
					<%if(typeof list[i].content.category_path !== 'undefined' && list[i].content.type_str === 'public'){%>
					<%:=getCategoryPathStr(list[i].content.category_path)%>
					<%}%>
				</p>
			</div>
			<div class="card-footer text-muted text-left" style="position:relative">
				<%:=getFormatDate(list[i].content.create_time, 'yyyy年MM月dd日 hh:mm')%>
				<div style="position: absolute; right: 1em; font-size: 1.25em">
					<span data-id="<%:=list[i].content.id%>" class="footer-icon icon-external-link" data-shown="0" onclick="showPostForward(this)" style="right:7em; bottom: -0.14em"></span>
					<span id="forward_cnt_<%:=list[i].id%>" class="footer-text" style="right:6em"><%:=list[i].content.forward_cnt%></span>
					<span data-id="<%:=list[i].content.id%>" data-shown="0" onclick="showPostComment(this, 'l1', 'popular')"
						  class="footer-icon icon-comment-alt" style="right:4.5em; bottom: 0em"></span>
					<span id="comment_l1_cnt_<%:=list[i].content.id%>" class="footer-text" style="right:3.5em"><%:=list[i].content.comment_cnt%></span>
					<%if(list[i].content.liked_by_viewer){%>
					<span style="right:2em; bottom: -0.075em" data-liked="1" data-id="<%:=list[i].content.id%>"
						  onclick="createOrCancelLike(this, 'post')" class="footer-icon icon-heart">
								</span>
					<%}else{%>
					<span style="right:2em; bottom: -0.075em" data-liked="0" data-id="<%:=list[i].content.id%>"
						  onclick="createOrCancelLike(this, 'post')" class="footer-icon icon-heart-empty">
								</span>
					<%}%>
					<span id="like_cnt_post_<%:=list[i].content.id%>" class="footer-text"
						  style="right:1em"><%:=list[i].content.like_cnt%></span>
				</div>
			</div>
		</div>
		<%:=commentOfPostTp({post: list[i].content})%>
		<%:=forwardOfPostTp({post: list[i].content})%>
		<%}%>
	</script>

	<div class="modal fade" id="img-modal" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content w-auto">
				<img id="modal-img"/>
			</div>
		</div>
	</div>

	<script src="js/common.js"></script>
	<script src="js/comp/navbar.js"></script>
	<script src="js/comp/content.js"></script>
	<script src="js/comp/comment.js"></script>
	<script src="js/comp/forward.js"></script>
	<script src="js/post_news.js"></script>
</html>